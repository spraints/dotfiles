if [ -d "${HOME}/.commonrcstarts" ]; then
  __commonrc_log="${HOME}/.commonrcstarts/$(date +%s)-$$.log"
  function __commonrc_step() {
    (date -Ins; echo "$@")>>"$__commonrc_log"
  }
else
  function __commonrc_step() {
    :
  }
fi

__commonrc_step ZSHRCINIT
source ~/.commonrc

__commonrc_step ZSHRCLOADFUNCS
for fun in ~/.shell-functions/*; do
  # Look for a line like "# ok: zsh"
  if grep -Eq '^# ok:.* zsh($| )' $fun; then
    source $fun
  fi
done

PROMPT='%m %F{yellow}%*%f (%F{magenta}%j%f) >>> '
#PROMPT=jkjk
#PS1='[$$] '$(hostname | cut -d . -f 1)' \[\e[33;1m\]\t \[\e[0m\](\[\e[35;1m\]\j\[\e[0m\])$(parse_git_branch)$(audible_ps1) >>> '
# see https://github.com/starship/starship/blob/master/src/init/starship.zsh

# Use ^A for beginning of line, etc.
bindkey -e

__commonrc_step ZSHRCSTARSHIP
# brew install starship
if which starship >/dev/null 2>/dev/null; then
  export STARSHIP_THIS_PID=$$
  eval "$(starship init zsh 2>/dev/null)"
fi

__commonrc_step ZSHRCBREW
# https://docs.brew.sh/Shell-Completion
if type brew >&/dev/null; then
  FPATH=$(brew --prefix)/share/zsh/site-functions:$FPATH
  autoload -Uz compinit
  compinit
fi

__commonrc_step ZSHRCFZF
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

__commonrc_step PSCOMPLETIONS
update-ps-completions() {
  which kubectl        >&/dev/null && source <(kubectl completion zsh)
  which pskube         >&/dev/null && source <(pskube --completion zsh)
  which singularityctl >&/dev/null && source <(singularityctl completion zsh)
}
update-ps-completions

__commonrc_step ZSHRCMCFLY
if which mcfly >/dev/null 2>/dev/null; then
  export MCFLY_RESULTS_SORT=LAST_RUN
  eval "$(mcfly init zsh)"
fi
__commonrc_step ZSHRCFIN
